"use strict";(()=>{function z(d,r){let a;return d=gsap.utils.toArray(d),r=r||{},gsap.context(()=>{let l=r.onChange,u=0,e=gsap.timeline({repeat:r.repeat,onUpdate:l&&function(){let t=e.closestIndex();u!==t&&(u=t,l(d[t],t))},paused:r.paused,defaults:{ease:"none"},onReverseComplete:()=>e.totalTime(e.rawTime()+e.duration()*100)}),i=d.length,g=d[0].offsetLeft,c=[],p=[],E=[],T=[],f=0,C=!1,w=r.center,L=(r.speed||1)*100,x=r.snap===!1?t=>t:gsap.utils.snap(r.snap||1),A=0,P=w===!0?d[0].parentNode:gsap.utils.toArray(w)[0]||d[0].parentNode,m,F=()=>d[i-1].offsetLeft+T[i-1]/100*p[i-1]-g+E[0]+d[i-1].offsetWidth*gsap.getProperty(d[i-1],"scaleX")+(parseFloat(r.paddingRight)||0),D=()=>{let t=P.getBoundingClientRect(),n;d.forEach((s,o)=>{p[o]=parseFloat(gsap.getProperty(s,"width","px")),T[o]=x(parseFloat(gsap.getProperty(s,"x","px"))/p[o]*100+gsap.getProperty(s,"xPercent")),n=s.getBoundingClientRect(),E[o]=n.left-(o?t.right:t.left),t=n}),gsap.set(d,{xPercent:s=>T[s]}),m=F()},v,N=()=>{A=w?e.duration()*(P.offsetWidth/2)/m:0,w&&c.forEach((t,n)=>{c[n]=v(e.labels["label"+n]+e.duration()*p[n]/2/m-A)})},R=(t,n,s)=>{let o=t.length,h=1e10,y=0,S;for(;o--;)S=Math.abs(t[o]-n),S>s/2&&(S=s-S),S<h&&(h=S,y=o);return y},H=()=>{let t,n,s,o,h;for(e.clear(),t=0;t<i;t++)n=d[t],s=T[t]/100*p[t],o=n.offsetLeft+s-g+E[0],h=o+p[t]*gsap.getProperty(n,"scaleX"),e.to(n,{xPercent:x((s-h)/p[t]*100),duration:h/L},0).fromTo(n,{xPercent:x((s-h+m)/p[t]*100)},{xPercent:T[t],duration:(s-h+m-s)/L,immediateRender:!1},h/L).add("label"+t,o/L),c[t]=o/L;v=gsap.utils.wrap(0,e.duration())},B=t=>{let n=e.progress();e.progress(0,!0),D(),t&&H(),N(),t&&e.draggable&&e.paused()?e.time(c[f],!0):e.progress(n,!0)},q=()=>B(!0),I;gsap.set(d,{x:0}),D(),H(),N(),window.addEventListener("resize",q);function O(t,n){n=n||{},Math.abs(t-f)>i/2&&(t+=t>f?-i:i);let s=gsap.utils.wrap(0,i,t),o=c[s];return o>e.time()!=t>f&&t!==f&&(o+=e.duration()*(t>f?1:-1)),(o<0||o>e.duration())&&(n.modifiers={time:v}),f=s,n.overwrite=!0,gsap.killTweensOf(I),n.duration===0?e.time(v(o)):e.tweenTo(o,n)}if(e.toIndex=(t,n)=>O(t,n),e.closestIndex=t=>{let n=R(c,e.time(),e.duration());return t&&(f=n,C=!1),n},e.current=()=>C?e.closestIndex(!0):f,e.next=t=>O(e.current()+1,t),e.previous=t=>O(e.current()-1,t),e.times=c,e.progress(1,!0).progress(0,!0),r.reversed&&(e.vars.onReverseComplete(),e.reverse()),r.draggable&&typeof Draggable=="function"){I=document.createElement("div");let t=gsap.utils.wrap(0,1),n,s,o,h,y,S,V,k=()=>e.progress(t(s+(o.startX-o.x)*n)),W=()=>e.closestIndex(!0);typeof InertiaPlugin>"u"&&console.warn("InertiaPlugin required for momentum-based scrolling and snapping. https://greensock.com/club"),o=Draggable.create(I,{trigger:d[0].parentNode,type:"x",onPressInit(){let _=this.x;gsap.killTweensOf(e),V=!e.paused(),e.pause(),s=e.progress(),B(),n=1/m,S=s/-n-_,gsap.set(I,{x:s/-n})},onDrag:k,onThrowUpdate:k,overshootTolerance:0,inertia:!0,snap(_){if(Math.abs(s/-n-this.x)<10)return y+S;let X=-(_*n)*e.duration(),U=v(X),$=c[R(c,U,e.duration())],b=$-U;return Math.abs(b)>e.duration()/2&&(b+=b<0?e.duration():-e.duration()),y=(X+b)/e.duration()/-n,y},onRelease(){W(),o.isThrowing&&(C=!0)},onThrowComplete:()=>{W(),V&&e.play()}})[0],e.draggable=o}return e.closestIndex(!0),u=f,l&&l(d[f],f),a=e,()=>window.removeEventListener("resize",q)}),a}var j=".section_stories",G=document.querySelectorAll(j),M=class{COMPONENT_SELECTOR='[data-slider-el="component"]';NAV_PREV_BUTTON_SELECTOR='[data-slider-el="nav-prev"]';NAV_NEXT_BUTTON_SELECTOR='[data-slider-el="nav-next"]';STORIES_ITEM_SELECTOR=".stories_item";ACTIVE_SLIDE_CLASS="is-active";sectionEl;storyItemsList;storyItemCount=0;constructor(r){if(console.info("[StorySlider] init"),this.sectionEl=r,this.storyItemsList=Array.from(this.sectionEl.querySelectorAll(this.STORIES_ITEM_SELECTOR)),this.storyItemCount=this.storyItemsList.length,!this.storyItemCount){console.warn("[StorySlider] no story items found");return}this.initDraggableMainSlider(),this.bindInnerSliderBoundaryClicks()}initDraggableMainSlider(){let r,a=z(this.storyItemsList,{paused:!0,draggable:!0,center:!0,onChange:(l,u)=>{r&&r.classList.remove(this.ACTIVE_SLIDE_CLASS),l.classList.add(this.ACTIVE_SLIDE_CLASS),r=l}});this.sectionEl.querySelector(`${this.NAV_NEXT_BUTTON_SELECTOR}:not(.story-modal_nav-button)`)?.addEventListener("click",()=>a.next({duration:.4,ease:"power1.inOut"})),this.sectionEl.querySelector(`${this.NAV_PREV_BUTTON_SELECTOR}:not(.story-modal_nav-button)`)?.addEventListener("click",()=>a.previous({duration:.4,ease:"power1.inOut"}))}bindInnerSliderBoundaryClicks(){let r=document.querySelectorAll(`dialog[data-dialog-id] ${this.COMPONENT_SELECTOR}`);console.info(`[StorySlider] inner sliders inside dialogs found: ${r.length}`),r.forEach((a,l)=>{console.debug("[StorySlider] binding inner slider",{idx:l,componentEl:a}),a.addEventListener("click",u=>{let e=u.target;if(!e)return;let i=e.closest(this.NAV_NEXT_BUTTON_SELECTOR),g=e.closest(this.NAV_PREV_BUTTON_SELECTOR),c=p=>!!p&&p.closest(this.COMPONENT_SELECTOR)===a;if(c(i)){let p=this.isNavDisabled(i),E=this.getInnerActivePosition(a),T=!!E&&E.index===E.count-1;console.log("[StorySlider] next clicked",{idx:l,disabled:p,atLast:T,nextBtn:i}),T&&(u.preventDefault(),u.stopPropagation(),this.handoffToAdjacentStory(a,"next"));return}if(c(g)){let p=this.isNavDisabled(g),E=this.getInnerActivePosition(a),T=!!E&&E.index===0;console.log("[StorySlider] prev clicked",{idx:l,disabled:p,atFirst:T,prevBtn:g}),T&&(u.preventDefault(),u.stopPropagation(),this.handoffToAdjacentStory(a,"prev"));return}})})}isNavDisabled(r){return r.classList.contains("is-disabled")||r.getAttribute("aria-disabled")==="true"||r.hasAttribute("disabled")}handoffToAdjacentStory(r,a){let l=r.closest("dialog[data-dialog-id]");if(!l){console.warn("[StorySlider] no current dialog found for inner slider");return}let u,e=l.closest(this.STORIES_ITEM_SELECTOR),i=this.storyItemsList.indexOf(e);i===this.storyItemCount-1?u=this.storyItemsList[0]:u=this.storyItemsList[i+1];let g=u.querySelector("dialog[data-dialog-id]");if(!g){console.warn("[StorySlider] target slide has no dialog",{dir:a,targetSlide});return}console.log("[StorySlider] handoff",{dir:a,fromDialog:l.getAttribute("data-dialog-id"),toDialog:g.getAttribute("data-dialog-id")}),this.closeDialog(l),this.openDialog(g)}getInnerActivePosition(r){let l=r.querySelector(".swiper")?.querySelector(".swiper-wrapper");if(!l)return null;let u=Array.from(l.querySelectorAll(".swiper-slide:not(.swiper-slide-duplicate)")),e=u.length;if(e===0)return{index:0,count:0,activeEl:null};let i=l.querySelector(".swiper-slide.is-active");i||(i=l.querySelector(".swiper-slide-active"));let g=u.findIndex(c=>c===i);return{index:g<0?0:g,count:e,activeEl:i}}openDialog(r){typeof r.showModal=="function"?r.showModal():r.setAttribute("open","");let a=new CustomEvent("dialogOpen",{detail:{dialogId:r.getAttribute("data-dialog-id")}});r.dispatchEvent(a)}closeDialog(r){typeof r.close=="function"?r.close():r.removeAttribute("open");let a=new CustomEvent("dialogClose",{detail:{dialogId:r.getAttribute("data-dialog-id")}});r.dispatchEvent(a)}};console.info("[StorySlider] script loaded");window.Webflow=window.Webflow||[];window.Webflow.push(()=>{G.forEach(d=>{new M(d)})});})();
